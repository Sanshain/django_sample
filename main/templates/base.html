<!DOCTYPE html>
{% load staticfiles %}
<html>

	<head>{% load staticfiles %}
		<meta charset="utf-8" />
		
		<title>{% block title %}{{ header }}{% endblock %}</title>
		
		<link rel="stylesheet" href="{% static 'base.css' %}">
		
{% block links %}
	<script src="{% static 'ajax.js' %}"></script>
	
	<script src="{% static 'js/base.js' %}"></script>
	
	<script src="{% static 'js/common.js' %}"></script>
{% endblock %}	
		
		<style>
		
			{% block style %}				

			{% endblock %}					
			
		</style>
		
		<script>
		
			{% block script %}
				
				dom = document;
                dom.obj = document.getElementById;
                dom.get = document.querySelector;
				
				window.onload = function()
				{
				
					/*! ерунда:
					var menu = document.querySelector('nav');
					var points = menu.getElementsByTagName('section_nav');
					*/
					
					
					
					dom.obj('me').onclick = function(e){
						
						if (!window.atob) return true;
						else e.preventDefault();
						
						
						
					}
					
					/*!
						Универсальная функция частичной перезагрузки страницы
						
						Пока для кнопок и ссылок. 
					*/
					function fragment_refresh(e){
						
						var target = 
							e.target.href || 
							e.target.formAction;
						
						if (!window.atob){   //<ie10
						
							document.location.href = target;
						}
												
						
						e.preventDefault();
						
						var ajax = new Ajax(target, render_page);
						
						/*определяем, есть ли те или иные элементы на странице, чтобы собщить серверу, какой из
						шаблонов рендерить и возвращать*/
						
						/*теоретически это можно получать на сервере 
						из адреса страницы, но тогда по сути придется проверять весь список адресов
						(регулярк) на соответствие, после нахождения
						необходимо распарсить шаблон и найти, есть ли там этот элемент. Проще найти тут:
						*/
						
						var elem =document.querySelector('.detail');
						var flag = Boolean(elem);
						
						ajax.onfail = function(){
							//здесь может быть относительно 
							// навязчивое сообщение о том, что 
							//ваш браузер не поддерживает 
							//автоматические переходы
							alert('ваш браузер не смог осуществить частичное обновление контента страницы.'+
							' Нажмите ок, чтобы перейти напрямую');
							document.location.href = target;
						};
						
						ajax.postData('detail='+Number(flag));
					}					
					
					//document.querySelector('#_dialogs').onclick =
					
					
					
					{% block onload %} {% endblock %}
				}
				
				
			{% endblock %}

		</script>
		
	</head>

	<body>

		<header>
				
			<div class='header'>
				<div class='nav' id='nav'>
				
					{% if request.user.is_authenticated and user.Image %}
						<a style='display:inline-block;float:left;position:relative;cursor:pointer;z-index:10' href="{% url 'user' user.id %}">
							<img style='border-radius: 25px;position:relative;top:5px;left:45px;' src='{{user.Image.url}}' height=50 width=50 />
						</a>
					{% endif %}		
				
					<nav>						
						{% block nav %}				
							
						    <a id='me' 
								name='{{user.id}}' 
								href="{% url 'user' user.id %}" class='section_nav'>
								
									К себе
									
							</a><!--
							--><a 
							href="{% url 'dialogs' %}" 
								id='_dialogs' 
								class='section_nav'
								onclick = 'fragment_refresh(event)'
								data-for_refresh='content'>
									
									Общение
									
							</a><!--
							--><a 
							href="{% url 'groups' %}" 
								id='_groups' 
								class='section_nav'>
								
									Сообщества
								
							</a><!--
							
							--><a 
								href="{% url 'signout' %}" 
								class='section_nav'>
								
									Выйти
								
							</a> 							
						{% endblock %}		
						
					</nav>			
				</div>
				<h2 id='header'>{% block header %} {% endblock %}</h2>
				
			</div>				
			
		</header>
		
		
	
		<div id='content'>
		
			
			<div id='main'> {# может быть слева, может быть центр #}
			
				{% block main %}
					главное уникальное содержимое
				{% endblock %}				
			
			</div>
		
				
			<div id="section">
			
				{# может быть слева, может быть центр #}
				
				{% block section %}
					дополнительны[ы|е] элемент[ы] основного потока
				{% endblock %}
				
			</div>
		
		</div>	

		
		<div id='aside'> 
			
			{% block aside %}
				
				боковая колонка: управляется через id='aside'
				
			{% endblock %}
		
		</div>		
		
	</body>

</html>